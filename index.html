<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>jQuery Multicomplete by @tomhallam</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="demo.css" />
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>jQuery Multicomplete</h1>
        <p></p>
        <ul>
          <li><a href="https://github.com/tomhallam/jQuery-Multicomplete/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/tomhallam/jQuery-Multicomplete/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/tomhallam/jQuery-Multicomplete">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h3>Let your users find what they want, instantly.</h3>

<p>I created jQuery Multicomplete while I was working at <a href="http://nudgedigital.co.uk">Nudge Digital</a> because I saw a need for multiple result groups in one autocomplete action. Think the <a href="http://last.fm">last.fm</a> search box. Allow your users to find what they want, over multiple fields, instantly.</p>
<p>Tested in IE6+, FF3+, Safari, Opera 10+ and Chrome. Try it yourself below!</p>

<form id="form-demo-field">
    <div>
        <label for="input-demo-multicomplete">City</label>
        <input type="text" name="demo1" id="input-demo-multicomplete" placeholder="Try London or Amsterdam!" />
    </div>
</form>

<h3>How to use it</h3>

<p>Installation couldn't be simpler! Simply include jQuery, the Multicomplete plugin (including it's CSS if you want it to look pretty!) and add this to your initialisation code for the page:</p>

<pre><code>$(document).ready(function() {
    $('#my-input').multicomplete({
        'source': 'search.php'
    });
});
</code></pre>

<p>This will create an instance of Multicomplete which will query <code>search.php</code> to get its results by sending what was written in the input as a <code>query</code> header. If the plugin was set to use the <code>GET</code> method then the request would be <code>search.php?query=what+i+asked+for</code>. The next step is to get <code>search.php</code> to return what we need for the plugin to work!</p>

<h3>Generating result JSON</h3>

<p>The plugin expects data back in a certain format, otherwise it will not work as expected. Consider this following excerpt from the demo:</p>
<pre><code>{
    "Takeaway": [
        {
            name: "Bobby's Takeaway",
            address: "162a Stopes Croft, Bristol, TE5 3TT",
            cuisine: "Moroccan, Wraps"
        }
    ],
    "Pubs": [
        {
            name: "The Pipe and Slippers",
            address: "11 Chelston Road, Bristol, TE5 3TT",
            cuisine: "Pies, roasts, etc."
        },
        {
            name: "The Hatchet",
            address: "27 Frog Street, Bristol, TE5 3TT",
            cuisine: "English pub grub"
        }
    ]
}
</code></pre>

<p>You have the following structure:</p>

<pre><code>{
  [name of group]: [
        {
            [result 1]
        },
        {
            [result 2]
        }
    ],
  [name of group]: [
        {
            [result 1]
        },
        {
            [result 2]
        },
        {
            [result 3]
        },
        [...]
    ],
}</code></pre>

<p>Which can easily be generated in PHP or another language of your choice.</p>

<p><strong>Important: </strong>jQuery Multicomplete has been designed to work with JSON only at this stage.</p>

<h3>Example of generating result JSON in PHP</h3>

<p>Here's a really simple example script to generate some results using a fake dataset. This code is not efficient and really is just meant  as a jump off point to get you thinking about how you'd grab your data.This example is using <a href="http://www.codeigniter.com">CodeIgniter and the Active Record Class</a>:</p>

<strong>application/models/search_model.php</strong>
<pre>
class Search_Model extends CI_Model {

    public function search_users($query) {
        $this->db->like('users.first_name', $query);
        $this->db->like('users.last_name', $query);
        $this->db->like('users.address_line_1', $query);
        $this->db->like('users.town', $query);

        $users_object = $this->db->get('users');

        if($users_object->num_rows() > 0) {
            return $users_object->result();
        }
        else {
            return array();
        }
    }

    public function search_books($query) {
        $this->db->join('authors', 'authors.id = books.author_id');
        $this->db->like('authors.name', $query);
        $this->db->like('books.name', $query);
        $this->db->like('books.publish_date', $query);
        $this->db->like('books.genre', $query);

        $books_object = $this->db->get('books');

        if($books_object->num_rows() > 0) {
            return $books_object->result();
        }
        else {
            return array();
        }
    }

}
</pre>

<strong>application/controllers/search.php</strong>
<pre>
class Search extends CI_Controller {
    
    public function search() {
        // Import variable from POST
        $query = $this->input->post('query');
        
        if(!empty($query)) {
            $this->load->model('search_model');
            
            // Perform the searches
            $users = $this->search_model->search_users($query);
            $books = $this->search_model->search_books($query);

            // Format the result
            $result = array(
                'Users' => $users,
                'Books' => $books
            );

            // Send the result back to the browser
            header('Content-Type: application/json');
            echo json_encode($result);
            exit;

        }

    }

}
</pre>

<p>For these examples to work, <code>source</code> needs to be set to <code>/search/search</code> in the initialization settings. See below for more information.</p>

<h3>Initialization settings / Options</h3>

<table>
    <thead>
    <th>Option</th>
    <th>Default</th>
    <th>Effect</th>
    </thead>
    <tbody>
        <tr>
            <td>debug</td>
            <td>true</td>
            <td>Provides error messages and logs variables to the console</td>
        </tr>
        <tr>
            <td valign="top">source</td>
            <td valign="top">[ ]</td>
            <td>
                <strong>When set to a string</strong><br />
                Example: <code>search.php</code><br />
                Will perform an AJAX request to this URL in an attempt to get a JSON response with your results.<br /><br />
                <strong>When set to an array</strong><br />
                Example: <a href="demo-source.json">see example</a><br />
                Will search the local array based on the query. Much quicker than a AJAX request. Ignores <code>min_length</code> and <code>delay</code>.
            </td>
        </tr>
        <tr>
            <td>method</td>
            <td>POST</td>
            <td>Can be one of <code>GET</code> or <code>POST</code>. This dictates how the AJAX request is performed if <code>source</code> is set to a string.</td>
        </tr>
        <tr>
            <td>minimum_length</td>
            <td>3</td>
            <td>How many characters the query needs to be before a search is triggered</td>
        </tr>
        <tr>
            <td>search_delay</td>
            <td>500</td>
            <td>How many milliseconds after the last key is pressed before a search is triggered.</td>
        </tr>
         <tr>
            <td>case_sensitive</td>
            <td>false</td>
            <td>When set to <code>true</code>, the search will only return results that match the exact case of the query.</td>
        </tr>
        <tr>
            <td>highlight_results</td>
            <td>true</td>
            <td>Highlights the terms found within the result. Will only apply if the actual term is included in the template. Creates a <code>span</code> with a class of <code>highlight</code> to the found node.</td>
        </tr>
        <tr>
            <td>offset_left</td>
            <td>0</td>
            <td>The results pane will be created at the bottom of the input element with a left offset of <code>offset_left</code> pixels. You do not need to include "px" on the end of this value.</td>
        </tr>
        <tr>
            <td>offset_top</td>
            <td>0</td>
            <td>The results pane will be created at the bottom of the input element with a top offset of <code>offset_top</code> pixels. You do not need to include "px" on the end of this value.</td>
        </tr>
        <tr>
            <td>result_template</td>
            <td>N/A</td>
            <td><a href="#result_templates">See the results section</a> for more information on how to create result templates.</td>
        </tr>
        <tr>
            <td>result_click</td>
            <td>N/A</td>
            <td>Specify a function to be executed when a result is clicked. This function is passed the <code>result</code> as the first parameter, which contains the row object itself. The second parameter is <code>group</code> which is a string with the name of the group.</td>
        </tr>
        <tr>
            <td>form_submit</td>
            <td>N/A</td>
            <td>Specify a function to be executed when the form that encapsulates this element is submitted. See the discussion on form submissions for more information on what happens by default.</td>
        </tr>
    </tbody>
</table>

<h3>Hidden fields and searching</h3>
<p>jQuery Multicomplete searches all of the available fields provided in a given row to return results. This means the user will most likely receive a piece of information that they were searching for. It's up to you whether you actually display that field (but a good user experience would definitely include it to show why that result has been shown to them!). You can fully control the output of a given result by changing the result template.</p>

<h3><a name="result_templates"></a>Result Templates</h3>

<p>A crucial element of the plugin is the ability to define how the results are displayed. Fortunately jQuery Multicomplete allows for complete flexibility over the markup output for various types of results. Below is the example template we use on the demo at the top of this page:</p>
<script src="https://gist.github.com/3398044.js"></script>
<p><code>function(result, group, field)</code> is simply being passed the row of the resultset that was matched as the first parameter and the group the row was in as the second. The third and final parameter contains the name of the field which the result was matched in, which is very useful if you only want to display fields that contained results. This can be used to generate any form of markup you need for the resultset.</p>

<h3>Authors and Contributors</h3>
<p>Built with lots of love by <a href="http://github.com/tomhallam">@tomhallam</a>. Initially developed for <a href="http://www.nudgedigital.co.uk">Nudge Digital</a> (they're a wicked agency in Bristol that do web applications!).</p>

      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/tomhallam">tomhallam</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="https://raw.github.com/tomhallam/jQuery-Multicomplete/master/lib/jquery-multicomplete.js"></script>
    <script>
        $(document).ready(function() {
            $('#input-demo-multicomplete').multicomplete({
                'source': {
                    "Attractions": [
                        {
                            "name": "The Tower of London",
                            "address": "London, EC3N 4AB",
                            "image": "http://www.hrp.org.uk/Images/TOL_Main.jpg"
                        },
                        {
                            "name": "Camden Lock Market",
                            "address": "1 Kentish Town Road, London, NW1 8",
                            "image": "http://www.london-attractions.info/images/attractions/camden-market.jpg"
                        },
                        {
                            "name": "Anne Frank Museum",
                            "address": "Prinsengracht 267, 1000 AS, Amsterdam",
                            "image": "http://upload.wikimedia.org/wikipedia/commons/thumb/9/9c/AnneFrankHouseAmsterdamtheNetherlands.jpg/220px-AnneFrankHouseAmsterdamtheNetherlands.jpg"
                        }
                    ],
                    "Hotels": [
                        {
                            "name": "The Ritz",
                            "address": "150 Piccadilly, London, W1J 9BR",
                            "image": "http://www.londonhotels.net/images/photogallery/the-ritz-london/the-ritz-london.jpg"
                        },
                         {
                             "name": "51 Buckingham Gate",
                             "address": "51 Buckingham Gate, London, SW1E 6AF",
                             "image": "http://static.laterooms.com/hotelphotos/laterooms/193559/gallery/51-buckingham-gate-london_060620111405093617.jpg"
                         },
                         {
                             "name": "Hotel de l'Europe",
                             "address": "2–14 Nieuwe Doelenstraat, Amsterdam, 1012 CP ",
                             "image": "http://www.concierge.com/images/cnt/lists/goldlist06/europe/netherlands/amsterdam/hotel_de_leurope/amsterdam_hotel_002p.jpg"
                         }
                    ],
                    "Restaurant": [
                        {
                            "name": "Petrus",
                            "address": "1 Kinnerton Street, Knightsbridge, London, SW1X 8EA",
                            "image": "http://berkshirereview.net/images/petrus_london_dining.jpg"
                        },
                        {
                            "name": "Vermeer",
                            "address": "Prins Hendrikkade 59-72, 1012 AD Amsterdam ",
                            "image": "http://www.restaurantvermeer.nl/Portals/7/UltraPhotoGallery/3425/45/[7].Vermeer---desert-2.jpg"
                        }
                    ]
                },
                'offset_top': 11, // This is just for the demo to correct the autocomplete offset
                'result_template': function(result, group, field) {
                    tmpl = '<div>';
                    if(!!result.image) {
                        tmpl += '<div class="image"><img src="' + result.image + '" /></div>';
                    }
                        tmpl += '<div>' + result.name + '</div>';
                        if(!!result.address) {
                            tmpl += '<div class="meta">' + result.address + '</div>';
                        }
                    tmpl += '</div>';
                    return tmpl;
                },
                'result_click': function(row, group) {
                    alert('You chose "' + row.name + '" in ' + group);
                }
            });
        });
    </script>
  </body>
</html>
